name: Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ iOS

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    env:
      APP_NAME: "StudentBehavior"
      
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        uses: actions/checkout@v4
      
      - name: ğŸ Ø¥Ø¹Ø¯Ø§Ø¯ Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
        run: |
          pip install 'flet[cli]' --upgrade
          pip install -r requirements.txt
      
      - name: ğŸš€ Ø¥Ø¹Ø¯Ø§Ø¯ Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.22.0'
          channel: 'stable'
      
      - name: ğŸ”¨ Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ iOS
        run: |
          flet build ipa --project "$APP_NAME" --org "com.education" --verbose
      
      - name: ğŸ“¦ ØªØ¬Ù…ÙŠØ¹ IPA ÙŠØ¯ÙˆÙŠÙ‹Ø§
        run: |
          APP_BUNDLE=$(find . -name "*.app" -type d | head -n1)
          if [ -n "$APP_BUNDLE" ]; then
            mkdir -p Payload
            cp -r "$APP_BUNDLE" Payload/
            zip -qr "$APP_NAME.ipa" Payload
          fi
      
      - name: â¬†ï¸ Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        uses: actions/upload-artifact@v4
        with:
          name: ØªØ·Ø¨ÙŠÙ‚-iOS
          path: "*.ipa"
